import { Box, Drawer, Typography, IconButton, Chip, Divider, Button } from '@mui/material';
import CloseIcon from '@mui/icons-material/Close';
import BiotechIcon from '@mui/icons-material/Biotech';
import BugReportIcon from '@mui/icons-material/BugReport';
import { useStore } from '../../store';
import { demoData } from '../../data/demo_data';

export const VulnerabilityDetail = () => {
    const selectedThreatId = useStore((state) => state.selectedThreat);
    const setSelectedThreat = useStore((state) => state.setSelectedThreat);

    const threat = demoData.find(d => d.id === selectedThreatId);

    if (!selectedThreatId || !threat) return null;

    return (
        <Drawer
            anchor="right"
            open={!!selectedThreatId}
            onClose={() => setSelectedThreat(null)}
            variant="persistent"
            PaperProps={{
                sx: {
                    width: 400,
                    bgcolor: 'background.paper',
                    borderLeft: '1px solid rgba(0, 240, 255, 0.2)',
                    backdropFilter: 'blur(10px)',
                    p: 3
                }
            }}
        >
            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h5" color="primary" sx={{ fontFamily: 'Orbitron, sans-serif' }}>
                    {threat.id}
                </Typography>
                <IconButton onClick={() => setSelectedThreat(null)}>
                    <CloseIcon />
                </IconButton>
            </Box>

            <Chip
                label={threat.severity}
                sx={{
                    alignSelf: 'flex-start',
                    mb: 2,
                    bgcolor: threat.severity === 'Critical' ? 'rgba(255,0,0,0.2)' : 'rgba(255,234,0,0.2)',
                    color: threat.severity === 'Critical' ? '#ff4d6d' : '#fff9b0',
                    fontWeight: 'bold'
                }}
            />

            <Typography variant="body1" paragraph>
                {threat.description}
            </Typography>

            <Divider sx={{ my: 2, borderColor: 'rgba(255,255,255,0.1)' }} />

            <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                <Typography variant="subtitle2" color="text.secondary">METADATA</Typography>

                <Box sx={{ display: 'flex', justifyContent: 'space-between' }}>
                    <Typography variant="body2" color="text.secondary">Vulnerability Type:</Typography>
                    <Typography variant="body2">{threat.package}</Typography>
                </Box>
                <Box sx={{ display: 'flex', justifyContent: 'space-between' }}>
                    <Typography variant="body2" color="text.secondary">Current Version:</Typography>
                    <Typography variant="body2">{threat.currentVersion}</Typography>
                </Box>
                <Box sx={{ display: 'flex', justifyContent: 'space-between' }}>
                    <Typography variant="body2" color="text.secondary">Fixed Version:</Typography>
                    <Typography variant="body2" color="success.main">{threat.fixedVersion}</Typography>
                </Box>
            </Box>

            <Box sx={{ mt: 4, display: 'flex', gap: 2 }}>
                <Button variant="contained" fullWidth startIcon={<BiotechIcon />}>
                    Analyze
                </Button>
                <Button variant="outlined" fullWidth startIcon={<BugReportIcon />} color="error">
                    Exploit
                </Button>
            </Box>
        </Drawer>
    );
};
