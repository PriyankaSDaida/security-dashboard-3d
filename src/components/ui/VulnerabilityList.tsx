import { DataGrid } from '@mui/x-data-grid';
import type { GridColDef, GridRowSelectionModel } from '@mui/x-data-grid';
import { Box, Paper, Typography } from '@mui/material';
import { useTheme } from '@mui/material/styles';
import { useStore } from '../../store';

const columns: GridColDef[] = [
    { field: 'id', headerName: 'ID', width: 90 },
    {
        field: 'severity', headerName: 'Severity', width: 130,
        renderCell: (params) => (
            <Box sx={{
                color: params.value === 'Critical' ? '#FF003C' : '#FFEA00',
                fontWeight: 'bold'
            }}>
                {params.value}
            </Box>
        )
    },
    { field: 'description', headerName: 'Vulnerability', width: 300, flex: 1 },
    { field: 'status', headerName: 'Status', width: 130 },
    { field: 'assigned', headerName: 'Owner', width: 160 },
];

const rows = [
    { id: 'cve-1', severity: 'Critical', description: 'CVE-2024-1234: Remote Code Execution', status: 'Open', assigned: 'Security Team A' },
    { id: 'sql-1', severity: 'High', description: 'SQL Injection in Login', status: 'In Progress', assigned: 'DevOps' },
    { id: 'auth-1', severity: 'High', description: 'Brute Force Anomaly', status: 'Analysis', assigned: 'SOC' },
    { id: 'xss-2', severity: 'Medium', description: 'Reflected XSS on Search', status: 'Open', assigned: 'Frontend' },
    { id: 'dep-3', severity: 'Low', description: 'Outdated Dependency: lodash', status: 'Patching', assigned: 'Bot' },
];

export const VulnerabilityList = () => {
    const theme = useTheme();
    const { selectedThreat, setSelectedThreat } = useStore();

    return (
        <Paper sx={{
            height: '100%',
            width: '100%',
            background: 'rgba(5, 10, 20, 0.8)', // Darker background for readability
            borderTop: `2px solid ${theme.palette.primary.main}`,
            display: 'flex',
            flexDirection: 'column',
            overflow: 'hidden'
        }}>
            <Box sx={{ p: 2, borderBottom: '1px solid rgba(255,255,255,0.1)' }}>
                <Typography variant="h6" color="primary">Active Vulnerabilities</Typography>
            </Box>
            <DataGrid
                rows={rows}
                columns={columns}
                checkboxSelection
                rowSelectionModel={selectedThreat ? [selectedThreat] : []}
                onRowSelectionModelChange={(newSelection: GridRowSelectionModel) => {
                    const selectionArray = newSelection as unknown as string[];
                    const id = selectionArray.length > 0 ? selectionArray[0] : null;
                    setSelectedThreat(id);
                }}
                sx={{
                    border: 'none',
                    color: 'text.primary',
                    '& .MuiDataGrid-row.Mui-selected': {
                        backgroundColor: `${theme.palette.secondary.main}20`,
                        '&:hover': {
                            backgroundColor: `${theme.palette.secondary.main}30`,
                        }
                    }
                }}
            />
        </Paper>
    );
};
